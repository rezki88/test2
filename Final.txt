#include <iostream>
#include <fstream>
#include <vector>
using namespace std;

//***Part1 Book***//
class Book {
public:
    string title;
    string author;
    int year;
    bool borrowed;

// initialiser un objet book
    Book(string t, string a, int y) {
        title = t;
        author = a;
        year = y;
        borrowed = false;
    }

    Book() { // mettre à vide
        title = "";
        author = "";
        year = 0;
        borrowed = false;
    }
	
	// defnir la fonction d'affichage
    void display() {
        cout << "Title: " << title << "\nAuthor: " << author
             << "\nYear: " << year
             << "\nBorrowed: " << (borrowed ? "Yes" : "No") << endl;
    }
	
	// defnir la fonction du prêt
    void borrowBook() {
        if (!borrowed) {
            borrowed = true;
            cout << "Book borrowed successfully.\n";
        } else {
            cout << "Book is already borrowed.\n";
        }
    }

	 // defnir la fonction du retour
    void returnBook() {
        if (borrowed) {
            borrowed = false;
            cout << "Book returned successfully.\n";
        } else {
            cout << "Book was not borrowed.\n";
        }
    }
	
	// defnir la fonction de la sauvegarde vers fichier text
    void saveToFile(ofstream &file) {
        file << "Book\n" << title << "\n" << author << "\n" << year << "\n" << borrowed << "\n";
    }
};


//*** Part2 Ebook ***//
class EBook : public Book {
public:
    double sizeMB;
	
	//héritage de book
    EBook(string t, string a, int y, double s)
        : Book(t, a, y) {
        sizeMB = s;
    }

    EBook() : Book() { // mettre à vide
        sizeMB = 0.0;
    }
	
	//fonction téléchargement
    void download() {
        cout << "Downloading \"" << title << "\" (" << sizeMB << " MB)... Done!\n";
    }
	//fonction affichage
    void display() {
        Book::display();
        cout << "Size: " << sizeMB << " MB" << endl;
    }
	// sauvegarde vers fichier text
    void saveToFile(ofstream &file) {
        file << "EBook\n" << title << "\n" << author << "\n" << year
             << "\n" << borrowed << "\n" << sizeMB << "\n";
    }
};


//*** Part3 library ***//
class Library {
public:
    vector<Book> books;
    vector<EBook> ebooks;

	//Ajouter un livre
    void addBook(Book b) {
        books.push_back(b);
        cout << "Book added.\n";
    }
	
	//Ajouter un e-book
    void addEBook(EBook e) {
        ebooks.push_back(e);
        cout << "EBook added.\n";
    }
	
	//Afficher tous les livres
    void displayAll() {
        cout << "\n--- Books ---\n";
        for (auto &b : books) {
            b.display();
            cout << endl;
        }
        cout << "--- EBooks ---\n";
        for (auto &e : ebooks) {
            e.display();
            cout << endl;
        }
    }
	
	//Rechercher un auteur
    void searchByAuthor(string name) {
        cout << "\nSearching for author: " << name << endl;
        bool found = false;
        for (auto &b : books) {
            if (b.author == name) {
                b.display();
                found = true;
            }
        }
        for (auto &e : ebooks) {
            if (e.author == name) {
                e.display();
                found = true;
            }
        }
        if (!found) cout << "No books found by that author.\n";
    }

	// Emprunter un livre
    void borrowBook(string title) {
        for (auto &b : books) {
            if (b.title == title) {
                b.borrowBook();
                return;
            }
        }
        for (auto &e : ebooks) {
            if (e.title == title) {
                e.borrowBook();
                return;
            }
        }
        cout << "Book not found.\n";
    }
	
	//Rendre un livre
    void returnBook(string title) {
        for (auto &b : books) {
            if (b.title == title) {
                b.returnBook();
                return;
            }
        }
        for (auto &e : ebooks) {
            if (e.title == title) {
                e.returnBook();
                return;
            }
        }
        cout << "Book not found.\n";
    }
	
	//Sauvegarder vers fichier text library
    void saveLibrary() {
        ofstream file("library.txt");
        for (auto &b : books) b.saveToFile(file);
        for (auto &e : ebooks) e.saveToFile(file);
        file.close();
        cout << "Library saved to library.txt\n";
    }
};

//***MAIN***//

int main() {
    Library myLibrary;
    int choice;

    do {
        cout << "\n--- Library Menu ---\n";
        cout << "1. Add a Book\n";
        cout << "2. Add an E-Book\n";
        cout << "3. Display all Books\n";
        cout << "4. Search by Author\n";
        cout << "5. Borrow a Book\n";
        cout << "6. Return a Book\n";
        cout << "7. Quit\n";
        cout << "Enter your choice: ";
        cin >> choice;
        cin.ignore(); // clear newline

        if (choice == 1) {
            Book b;
            cout << "Enter title: ";
            getline(cin, b.title);
            cout << "Enter author: ";
            getline(cin, b.author);
            cout << "Enter year: ";
            cin >> b.year;
            myLibrary.addBook(b);
        }
        else if (choice == 2) {
            EBook e;
            cout << "Enter title: ";
            getline(cin, e.title);
            cout << "Enter author: ";
            getline(cin, e.author);
            cout << "Enter year: ";
            cin >> e.year;
            cout << "Enter size in MB: ";
            cin >> e.sizeMB;
            myLibrary.addEBook(e);
        }
        else if (choice == 3) {
            myLibrary.displayAll();
        }
        else if (choice == 4) {
            string name;
            cout << "Enter author name: ";
            getline(cin, name);
            myLibrary.searchByAuthor(name);
        }
        else if (choice == 5) {
            string title;
            cout << "Enter book title to borrow: ";
            getline(cin, title);
            myLibrary.borrowBook(title);
        }
        else if (choice == 6) {
            string title;
            cout << "Enter book title to return: ";
            getline(cin, title);
            myLibrary.returnBook(title);
        }
        else if (choice == 7) {// Quitter la boucle pour terminer le programme
            cout << "Exiting program...\n";
            myLibrary.saveLibrary();
        }
        else {
            cout << "Invalid choice. Try again.\n";
        }

    } while (choice != 7); 

    return 0;
}
